<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Michaelis-Menten Kinetics Simulation</title>
	<script data-goatcounter="https://jtsatsaronis.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2em;
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .visualisation-panel {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
        }
        
        .charts-panel {
            display: grid;
            grid-template-rows: 1fr 1fr;
            gap: 20px;
        }
        
        .chart-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 15px;
            position: relative;
        }
        
        canvas {
            display: block;
            margin: 0 auto;
            border-radius: 10px;
        }
        
        #reactionCanvas {
            background: linear-gradient(to bottom, #e3f2fd, #bbdefb);
            width: 100%;
            height: 400px;
        }
        
        .controls {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .control-group {
            margin-bottom: 20px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        input[type="range"] {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }
        
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
        }
        
        .value-display {
            background: white;
            padding: 5px 12px;
            border-radius: 8px;
            font-weight: 600;
            color: #667eea;
            min-width: 60px;
            text-align: center;
        }
        
        .radio-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .radio-option input[type="radio"] {
            width: 16px;
            height: 16px;
        }
        
        .radio-option label {
            font-weight: normal;
            font-size: 14px;
        }
        
        .reset-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
            margin-top: 20px;
            width: 100%;
        }
        
        .reset-button:hover {
            background: #5a67d8;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
            font-size: 13px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .legend-colour {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            border: 2px solid #333;
        }
        
        .chart-title {
            text-align: center;
            font-weight: 600;
            color: #555;
            margin-bottom: 10px;
        }
        
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-top: 20px;
            border-radius: 8px;
        }
        
        .info-box h3 {
            color: #667eea;
            margin-bottom: 8px;
        }
        
        .info-box p {
            color: #555;
            line-height: 1.6;
        }
        
        .inhibitor-info {
            background: #f3e5f5;
            border-left: 4px solid #9C27B0;
            padding: 10px;
            margin-top: 10px;
            border-radius: 8px;
            font-size: 14px;
            display: none;
        }
        
        .inhibitor-info.active {
            display: block;
        }
        
        .speed-label {
            font-size: 12px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Michaelis-Menten Enzyme Kinetics Simulation</h1>
        
        <div class="controls">
            <div class="control-group">
                <label for="substrateSlider">Substrate Concentration [S]</label>
                <div class="slider-container">
                    <input type="range" id="substrateSlider" min="0" max="100" value="50">
                    <div class="value-display" id="substrateValue">50 mM</div>
                </div>
            </div>
            
            <div class="control-group">
                <label>Inhibitor Type</label>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="noInhibitor" name="inhibitor" value="none" checked>
                        <label for="noInhibitor">No Inhibitor</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="competitive" name="inhibitor" value="competitive">
                        <label for="competitive">Competitive</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="nonCompetitive" name="inhibitor" value="noncompetitive">
                        <label for="nonCompetitive">Non-competitive</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="covalent" name="inhibitor" value="covalent">
                        <label for="covalent">Covalent (Irreversible)</label>
                    </div>
                </div>
            </div>
            
            <div class="control-group">
                <label for="speedSlider">Simulation Speed</label>
                <div class="slider-container">
                    <span class="speed-label">Slow</span>
                    <input type="range" id="speedSlider" min="0.2" max="3" value="1" step="0.2">
                    <span class="speed-label">Fast</span>
                    <div class="value-display" id="speedValue">1.0Ã—</div>
                </div>
            </div>
            
            <div class="inhibitor-info" id="inhibitorInfo">
                <strong>Inhibitor Mechanism:</strong> <span id="inhibitorDesc"></span>
            </div>
            
            <button class="reset-button" id="resetButton">ðŸ”„ Reset Simulation</button>
        </div>
        
        <div class="main-grid">
            <div class="visualisation-panel">
                <div class="chart-title">Enzyme-Substrate Reaction</div>
                <canvas id="reactionCanvas"></canvas>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-colour" style="background: #2196F3;"></div>
                        <span>Substrate</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-colour" style="background: #4CAF50;"></div>
                        <span>Product</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-colour" style="background: #FF9800;"></div>
                        <span>Active Enzyme</span>
                    </div>
                    <div class="legend-item" id="inactiveLegend" style="display: none;">
                        <div class="legend-colour" style="background: #616161;"></div>
                        <span>Inactivated</span>
                    </div>
                    <div class="legend-item" id="inhibitorLegend" style="display: none;">
                        <div class="legend-colour" id="inhibitorColour" style="background: #9C27B0;"></div>
                        <span id="inhibitorLabel">Inhibitor</span>
                    </div>
                </div>
            </div>
            
            <div class="charts-panel">
                <div class="chart-container">
                    <div class="chart-title">Product Formation Over Time</div>
                    <canvas id="absorbanceChart" width="500" height="200"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Michaelis-Menten Plot</div>
                    <canvas id="mmChart" width="500" height="200"></canvas>
                </div>
            </div>
        </div>
        
        <div class="info-box">
            <h3>Current Kinetic Parameters</h3>
            <p id="kineticsInfo">
                Vmax = 100 Âµmol/min | Km = 25 mM | Current Rate = <span id="currentRate">--</span> Âµmol/min
            </p>
        </div>
    </div>

    <script>
        // Global variables
        let particles = [];
        let enzymes = [];
        let inhibitors = [];
        let substrateConcentration = 50;
        let inhibitorType = 'none';
        let simulationSpeed = 1;
        let timeData = [];
        let productData = [];
        let mmData = [];
        let animationId;
        let time = 0;
        let activeEnzymeCount = 5;
        
        // Kinetic parameters
        const baseVmax = 100;
        const baseKm = 25;
        let Vmax = baseVmax;
        let Km = baseKm;
        
        // Canvas setup
        const reactionCanvas = document.getElementById('reactionCanvas');
        const reactionCtx = reactionCanvas.getContext('2d');
        const absorbanceCanvas = document.getElementById('absorbanceChart');
        const absorbanceCtx = absorbanceCanvas.getContext('2d');
        const mmCanvas = document.getElementById('mmChart');
        const mmCtx = mmCanvas.getContext('2d');
        
        // Resize canvases
        function resizeCanvases() {
            reactionCanvas.width = reactionCanvas.offsetWidth;
            reactionCanvas.height = 400;
            absorbanceCanvas.width = 500;
            absorbanceCanvas.height = 200;
            mmCanvas.width = 500;
            mmCanvas.height = 200;
        }
        
        // Particle class
        class Particle {
            constructor(x, y, isSubstrate = true) {
                this.x = x;
                this.y = y;
                this.vx = (Math.random() - 0.5) * 2;
                this.vy = (Math.random() - 0.5) * 2;
                this.radius = 6;
                this.isSubstrate = isSubstrate;
                this.converting = false;
                this.conversionProgress = 0;
            }
            
            update() {
                this.x += this.vx * simulationSpeed;
                this.y += this.vy * simulationSpeed;
                
                // Bounce off walls
                if (this.x - this.radius < 0 || this.x + this.radius > reactionCanvas.width) {
                    this.vx = -this.vx;
                }
                if (this.y - this.radius < 0 || this.y + this.radius > reactionCanvas.height) {
                    this.vy = -this.vy;
                }
                
                // Keep in bounds
                this.x = Math.max(this.radius, Math.min(reactionCanvas.width - this.radius, this.x));
                this.y = Math.max(this.radius, Math.min(reactionCanvas.height - this.radius, this.y));
                
                // Handle conversion
                if (this.converting) {
                    this.conversionProgress += 0.02 * simulationSpeed;
                    if (this.conversionProgress >= 1) {
                        this.isSubstrate = false;
                        this.converting = false;
                        this.conversionProgress = 0;
                    }
                }
            }
            
            draw() {
                reactionCtx.beginPath();
                reactionCtx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                
                if (this.converting) {
                    // Interpolate colour during conversion
                    const r = Math.round(33 + (76 - 33) * this.conversionProgress);
                    const g = Math.round(150 + (175 - 150) * this.conversionProgress);
                    const b = Math.round(243 + (80 - 243) * this.conversionProgress);
                    reactionCtx.fillStyle = `rgb(${r}, ${g}, ${b})`;
                } else {
                    reactionCtx.fillStyle = this.isSubstrate ? '#2196F3' : '#4CAF50';
                }
                
                reactionCtx.fill();
                reactionCtx.strokeStyle = '#333';
                reactionCtx.lineWidth = 1;
                reactionCtx.stroke();
            }
        }
        
        // Inhibitor class
        class Inhibitor {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.vx = (Math.random() - 0.5) * 2.5;
                this.vy = (Math.random() - 0.5) * 2.5;
                this.radius = 5;
                this.boundToEnzyme = false;
                this.boundEnzyme = null;
                this.used = false; // For covalent inhibitors that get consumed
            }
            
            update() {
                if (!this.boundToEnzyme && !this.used) {
                    this.x += this.vx * simulationSpeed;
                    this.y += this.vy * simulationSpeed;
                    
                    // Bounce off walls
                    if (this.x - this.radius < 0 || this.x + this.radius > reactionCanvas.width) {
                        this.vx = -this.vx;
                    }
                    if (this.y - this.radius < 0 || this.y + this.radius > reactionCanvas.height) {
                        this.vy = -this.vy;
                    }
                    
                    // Keep in bounds
                    this.x = Math.max(this.radius, Math.min(reactionCanvas.width - this.radius, this.x));
                    this.y = Math.max(this.radius, Math.min(reactionCanvas.height - this.radius, this.y));
                } else if (this.boundEnzyme && !this.used) {
                    // Move with enzyme
                    if (inhibitorType === 'competitive') {
                        // Competitive binds at active site
                        this.x = this.boundEnzyme.x;
                        this.y = this.boundEnzyme.y;
                    } else if (inhibitorType === 'noncompetitive') {
                        // Non-competitive binds at allosteric site
                        this.x = this.boundEnzyme.x + this.boundEnzyme.radius * 0.8;
                        this.y = this.boundEnzyme.y + this.boundEnzyme.radius * 0.8;
                    } else if (inhibitorType === 'covalent') {
                        // Covalent permanently modifies enzyme
                        this.x = this.boundEnzyme.x;
                        this.y = this.boundEnzyme.y;
                        // Mark as used after binding
                        setTimeout(() => { this.used = true; }, 500);
                    }
                }
            }
            
            draw() {
                if (this.used) return; // Don't draw if consumed (covalent)
                
                reactionCtx.beginPath();
                reactionCtx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                
                // Different colours for different types
                if (inhibitorType === 'covalent') {
                    reactionCtx.fillStyle = '#D32F2F'; // Red for covalent
                } else {
                    reactionCtx.fillStyle = '#9C27B0'; // Purple for others
                }
                
                reactionCtx.fill();
                reactionCtx.strokeStyle = '#333';
                reactionCtx.lineWidth = 1;
                reactionCtx.stroke();
                
                // Draw shape to indicate type
                reactionCtx.fillStyle = 'white';
                reactionCtx.font = 'bold 8px Arial';
                reactionCtx.textAlign = 'center';
                reactionCtx.textBaseline = 'middle';
                
                if (inhibitorType === 'competitive') {
                    reactionCtx.fillText('C', this.x, this.y);
                } else if (inhibitorType === 'noncompetitive') {
                    reactionCtx.fillText('N', this.x, this.y);
                } else if (inhibitorType === 'covalent') {
                    reactionCtx.fillText('X', this.x, this.y);
                }
            }
        }
        
        // Enzyme class
        class Enzyme {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.vx = (Math.random() - 0.5) * 3;
                this.vy = (Math.random() - 0.5) * 3;
                this.radius = 12;
                this.bound = false;
                this.boundParticle = null;
                this.inhibitorBound = false;
                this.boundInhibitor = null;
                this.inhibitorBindingTime = 0;
                this.permanentlyInactivated = false; // For covalent inhibition
            }
            
            update() {
                this.x += this.vx * simulationSpeed;
                this.y += this.vy * simulationSpeed;
                
                // Bounce off walls
                if (this.x - this.radius < 0 || this.x + this.radius > reactionCanvas.width) {
                    this.vx = -this.vx;
                }
                if (this.y - this.radius < 0 || this.y + this.radius > reactionCanvas.height) {
                    this.vy = -this.vy;
                }
                
                // Keep in bounds
                this.x = Math.max(this.radius, Math.min(reactionCanvas.width - this.radius, this.x));
                this.y = Math.max(this.radius, Math.min(reactionCanvas.height - this.radius, this.y));
                
                // If permanently inactivated, do nothing else
                if (this.permanentlyInactivated) {
                    return;
                }
                
                // Check for inhibitor binding
                if (inhibitorType !== 'none' && !this.inhibitorBound) {
                    for (let inhibitor of inhibitors) {
                        if (!inhibitor.boundToEnzyme && !inhibitor.used) {
                            const dx = this.x - inhibitor.x;
                            const dy = this.y - inhibitor.y;
                            const distance = Math.sqrt(dx * dx + dy * dy);
                            
                            if (distance < this.radius + inhibitor.radius + 5) {
                                let bindingProb = inhibitorType === 'covalent' ? 0.015 : 0.01;
                                if (Math.random() < bindingProb * simulationSpeed) {
                                    this.inhibitorBound = true;
                                    this.boundInhibitor = inhibitor;
                                    inhibitor.boundToEnzyme = true;
                                    inhibitor.boundEnzyme = this;
                                    this.inhibitorBindingTime = 0;
                                    
                                    // For covalent, mark as permanently inactivated
                                    if (inhibitorType === 'covalent') {
                                        this.permanentlyInactivated = true;
                                        activeEnzymeCount = Math.max(0, activeEnzymeCount - 1);
                                    }
                                    break;
                                }
                            }
                        }
                    }
                }
                
                // Handle inhibitor unbinding (not for covalent)
                if (this.inhibitorBound && inhibitorType !== 'covalent') {
                    this.inhibitorBindingTime += simulationSpeed;
                    if (this.inhibitorBindingTime > 150) {
                        this.inhibitorBound = false;
                        if (this.boundInhibitor) {
                            this.boundInhibitor.boundToEnzyme = false;
                            this.boundInhibitor.boundEnzyme = null;
                            this.boundInhibitor = null;
                        }
                    }
                }
                
                // Check for substrate binding
                if (!this.bound && substrateConcentration > 0 && !this.permanentlyInactivated) {
                    // Competitive inhibitor blocks active site
                    if (inhibitorType === 'competitive' && this.inhibitorBound) {
                        return;
                    }
                    
                    for (let particle of particles) {
                        if (particle.isSubstrate && !particle.converting) {
                            const dx = this.x - particle.x;
                            const dy = this.y - particle.y;
                            const distance = Math.sqrt(dx * dx + dy * dy);
                            
                            if (distance < this.radius + particle.radius) {
                                // Binding probability based on inhibitor
                                let bindingProb = 0.08 * simulationSpeed;
                                if (inhibitorType === 'noncompetitive' && this.inhibitorBound) {
                                    bindingProb *= 0.3; // Reduced efficiency
                                }
                                
                                if (Math.random() < bindingProb) {
                                    this.bound = true;
                                    this.boundParticle = particle;
                                    particle.converting = true;
                                    break;
                                }
                            }
                        }
                    }
                } else if (this.bound && this.boundParticle) {
                    // Move with bound particle
                    this.x = this.boundParticle.x + 15;
                    this.y = this.boundParticle.y;
                    
                    if (!this.boundParticle.converting) {
                        this.bound = false;
                        this.boundParticle = null;
                    }
                }
            }
            
            draw() {
                reactionCtx.beginPath();
                reactionCtx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                
                // Colour based on state
                if (this.permanentlyInactivated) {
                    reactionCtx.fillStyle = '#616161'; // Grey for permanently inactivated
                } else if (this.inhibitorBound && inhibitorType === 'competitive') {
                    reactionCtx.fillStyle = '#E91E63'; // Pink when competitive inhibitor bound
                } else if (this.bound) {
                    reactionCtx.fillStyle = '#FF5722'; // Dark orange when substrate bound
                } else {
                    reactionCtx.fillStyle = '#FF9800'; // Orange when free
                }
                
                reactionCtx.fill();
                reactionCtx.strokeStyle = '#333';
                reactionCtx.lineWidth = 2;
                reactionCtx.stroke();
                
                // Draw X for permanently inactivated enzymes
                if (this.permanentlyInactivated) {
                    reactionCtx.strokeStyle = '#FFF';
                    reactionCtx.lineWidth = 3;
                    reactionCtx.beginPath();
                    reactionCtx.moveTo(this.x - 6, this.y - 6);
                    reactionCtx.lineTo(this.x + 6, this.y + 6);
                    reactionCtx.moveTo(this.x + 6, this.y - 6);
                    reactionCtx.lineTo(this.x - 6, this.y + 6);
                    reactionCtx.stroke();
                } else {
                    // Draw active site indicator
                    reactionCtx.beginPath();
                    reactionCtx.arc(this.x - 4, this.y, 3, 0, Math.PI * 2);
                    reactionCtx.fillStyle = this.bound || (this.inhibitorBound && inhibitorType === 'competitive') ? '#333' : '#FFF';
                    reactionCtx.fill();
                    
                    // Draw allosteric site for non-competitive
                    if (inhibitorType === 'noncompetitive') {
                        reactionCtx.beginPath();
                        reactionCtx.arc(this.x + this.radius * 0.5, this.y + this.radius * 0.5, 3, 0, Math.PI * 2);
                        reactionCtx.fillStyle = this.inhibitorBound ? '#9C27B0' : '#FFF';
                        reactionCtx.fill();
                        reactionCtx.strokeStyle = '#333';
                        reactionCtx.lineWidth = 1;
                        reactionCtx.stroke();
                    }
                }
            }
        }
        
        // Initialise particles and enzymes
        function initParticles() {
            particles = [];
            enzymes = [];
            inhibitors = [];
            activeEnzymeCount = 5;
            
            // Create substrate particles based on concentration
            const numParticles = substrateConcentration > 0 ? Math.floor(substrateConcentration / 2) : 0;
            for (let i = 0; i < numParticles; i++) {
                particles.push(new Particle(
                    Math.random() * reactionCanvas.width,
                    Math.random() * reactionCanvas.height,
                    true
                ));
            }
            
            // Create enzymes
            for (let i = 0; i < 5; i++) {
                enzymes.push(new Enzyme(
                    Math.random() * reactionCanvas.width,
                    Math.random() * reactionCanvas.height
                ));
            }
            
            // Create inhibitors if needed
            if (inhibitorType !== 'none') {
                const numInhibitors = inhibitorType === 'covalent' ? 12 : 8;
                for (let i = 0; i < numInhibitors; i++) {
                    inhibitors.push(new Inhibitor(
                        Math.random() * reactionCanvas.width,
                        Math.random() * reactionCanvas.height
                    ));
                }
            }
        }
        
        // Calculate reaction rate
        function calculateRate(s) {
            let v;
            if (inhibitorType === 'competitive') {
                // Competitive inhibition: increases apparent Km
                const apparentKm = Km * 2.5;
                v = (Vmax * s) / (apparentKm + s);
            } else if (inhibitorType === 'noncompetitive') {
                // Non-competitive inhibition: decreases Vmax
                const apparentVmax = Vmax * 0.4;
                v = (apparentVmax * s) / (Km + s);
            } else if (inhibitorType === 'covalent') {
                // Covalent inhibition: progressively decreases active enzyme concentration
                const activeEnzymeRatio = activeEnzymeCount / 5;
                const apparentVmax = Vmax * activeEnzymeRatio;
                v = (apparentVmax * s) / (Km + s);
            } else {
                // No inhibition
                v = (Vmax * s) / (Km + s);
            }
            return v;
        }
        
        // Update MM plot
        function updateMMPlot() {
            mmData = [];
            for (let s = 0; s <= 100; s += 2) {
                mmData.push({
                    s: s,
                    v: calculateRate(s)
                });
            }
            drawMMChart();
        }
        
        // Draw MM chart
        function drawMMChart() {
            mmCtx.clearRect(0, 0, mmCanvas.width, mmCanvas.height);
            
            // Draw axes
            mmCtx.strokeStyle = '#666';
            mmCtx.lineWidth = 2;
            mmCtx.beginPath();
            mmCtx.moveTo(40, 10);
            mmCtx.lineTo(40, 160);
            mmCtx.lineTo(480, 160);
            mmCtx.stroke();
            
            // Draw labels
            mmCtx.fillStyle = '#666';
            mmCtx.font = '12px Arial';
            mmCtx.textAlign = 'center';
            mmCtx.fillText('[S] (mM)', 260, 185);
            
            mmCtx.save();
            mmCtx.translate(15, 85);
            mmCtx.rotate(-Math.PI / 2);
            mmCtx.fillText('Rate (Âµmol/min)', 0, 0);
            mmCtx.restore();
            
            // Draw grid lines
            mmCtx.strokeStyle = '#e0e0e0';
            mmCtx.lineWidth = 0.5;
            for (let i = 0; i <= 5; i++) {
                const y = 160 - (i * 30);
                mmCtx.beginPath();
                mmCtx.moveTo(40, y);
                mmCtx.lineTo(480, y);
                mmCtx.stroke();
                
                mmCtx.fillStyle = '#666';
                mmCtx.font = '10px Arial';
                mmCtx.textAlign = 'right';
                mmCtx.fillText((i * 20).toString(), 35, y + 3);
            }
            
            for (let i = 0; i <= 5; i++) {
                const x = 40 + (i * 88);
                mmCtx.beginPath();
                mmCtx.moveTo(x, 10);
                mmCtx.lineTo(x, 160);
                mmCtx.stroke();
                
                mmCtx.fillStyle = '#666';
                mmCtx.font = '10px Arial';
                mmCtx.textAlign = 'center';
                mmCtx.fillText((i * 20).toString(), x, 175);
            }
            
            // Draw curve
            mmCtx.strokeStyle = '#667eea';
            mmCtx.lineWidth = 3;
            mmCtx.beginPath();
            for (let i = 0; i < mmData.length; i++) {
                const x = 40 + (mmData[i].s * 4.4);
                const y = 160 - (mmData[i].v * 1.5);
                if (i === 0) {
                    mmCtx.moveTo(x, y);
                } else {
                    mmCtx.lineTo(x, y);
                }
            }
            mmCtx.stroke();
            
            // Draw current point
            const currentRate = calculateRate(substrateConcentration);
            const currentX = 40 + (substrateConcentration * 4.4);
            const currentY = 160 - (currentRate * 1.5);
            
            mmCtx.fillStyle = '#FF5722';
            mmCtx.beginPath();
            mmCtx.arc(currentX, currentY, 6, 0, Math.PI * 2);
            mmCtx.fill();
            mmCtx.strokeStyle = '#333';
            mmCtx.lineWidth = 2;
            mmCtx.stroke();
            
            // Draw Km and Vmax lines
            if (inhibitorType === 'none') {
                // Km line
                mmCtx.strokeStyle = 'rgba(255, 152, 0, 0.5)';
                mmCtx.lineWidth = 2;
                mmCtx.setLineDash([5, 5]);
                mmCtx.beginPath();
                mmCtx.moveTo(40 + (Km * 4.4), 160);
                mmCtx.lineTo(40 + (Km * 4.4), 160 - (Vmax/2 * 1.5));
                mmCtx.stroke();
                
                // Vmax line
                mmCtx.strokeStyle = 'rgba(76, 175, 80, 0.5)';
                mmCtx.beginPath();
                mmCtx.moveTo(40, 160 - (Vmax * 1.5));
                mmCtx.lineTo(480, 160 - (Vmax * 1.5));
                mmCtx.stroke();
                mmCtx.setLineDash([]);
            }
        }
        
        // Draw absorbance chart
        function drawAbsorbanceChart() {
            absorbanceCtx.clearRect(0, 0, absorbanceCanvas.width, absorbanceCanvas.height);
            
            // Draw axes
            absorbanceCtx.strokeStyle = '#666';
            absorbanceCtx.lineWidth = 2;
            absorbanceCtx.beginPath();
            absorbanceCtx.moveTo(40, 10);
            absorbanceCtx.lineTo(40, 160);
            absorbanceCtx.lineTo(480, 160);
            absorbanceCtx.stroke();
            
            // Draw labels
            absorbanceCtx.fillStyle = '#666';
            absorbanceCtx.font = '12px Arial';
            absorbanceCtx.textAlign = 'center';
            absorbanceCtx.fillText('Time (s)', 260, 185);
            
            absorbanceCtx.save();
            absorbanceCtx.translate(15, 85);
            absorbanceCtx.rotate(-Math.PI / 2);
            absorbanceCtx.fillText('Product (Âµmol)', 0, 0);
            absorbanceCtx.restore();
            
            // Draw grid
            absorbanceCtx.strokeStyle = '#e0e0e0';
            absorbanceCtx.lineWidth = 0.5;
            for (let i = 0; i <= 5; i++) {
                const y = 160 - (i * 30);
                absorbanceCtx.beginPath();
                absorbanceCtx.moveTo(40, y);
                absorbanceCtx.lineTo(480, y);
                absorbanceCtx.stroke();
            }
            
            // Draw data
            if (productData.length > 1) {
                absorbanceCtx.strokeStyle = '#4CAF50';
                absorbanceCtx.lineWidth = 3;
                absorbanceCtx.beginPath();
                for (let i = 0; i < productData.length; i++) {
                    const x = 40 + (i * 440 / 100);
                    const y = 160 - (productData[i] * 150 / 100);
                    if (i === 0) {
                        absorbanceCtx.moveTo(x, y);
                    } else {
                        absorbanceCtx.lineTo(x, y);
                    }
                }
                absorbanceCtx.stroke();
            }
        }
        
        // Animation loop
        function animate() {
            reactionCtx.clearRect(0, 0, reactionCanvas.width, reactionCanvas.height);
            
            // Update and draw particles
            particles.forEach(particle => {
                particle.update();
                particle.draw();
            });
            
            // Update and draw inhibitors
            inhibitors.forEach(inhibitor => {
                inhibitor.update();
                inhibitor.draw();
            });
            
            // Update and draw enzymes
            enzymes.forEach(enzyme => {
                enzyme.update();
                enzyme.draw();
            });
            
            // Update active enzyme count display for covalent inhibition
            if (inhibitorType === 'covalent') {
                const activeEnzymesElement = document.getElementById('activeEnzymes');
                if (activeEnzymesElement) {
                    activeEnzymesElement.textContent = `${activeEnzymeCount}/5`;
                }
                
                // Update current rate as enzymes get inactivated
                const currentRate = calculateRate(substrateConcentration);
                document.getElementById('currentRate').textContent = currentRate.toFixed(1);
                
                // Update MM plot if enzymes are being inactivated
                if (time % 60 === 0) {
                    updateMMPlot();
                }
            }
            
            // Update product data
            time++;
            if (time % Math.floor(30 / simulationSpeed) === 0) {
                const productCount = particles.filter(p => !p.isSubstrate).length;
                const product = productCount * 2;
                productData.push(product);
                if (productData.length > 100) {
                    productData.shift();
                }
                drawAbsorbanceChart();
            }
            
            animationId = requestAnimationFrame(animate);
        }
        
        // Reset simulation
        function resetSimulation() {
            productData = [];
            time = 0;
            activeEnzymeCount = 5;
            initParticles();
            drawAbsorbanceChart();
            updateMMPlot();
        }
        
        // Event listeners
        document.getElementById('substrateSlider').addEventListener('input', function(e) {
            substrateConcentration = parseFloat(e.target.value);
            document.getElementById('substrateValue').textContent = substrateConcentration + ' mM';
            
            // Update current rate display
            const currentRate = calculateRate(substrateConcentration);
            document.getElementById('currentRate').textContent = currentRate.toFixed(1);
            
            // Reset simulation
            resetSimulation();
        });
        
        document.getElementById('speedSlider').addEventListener('input', function(e) {
            simulationSpeed = parseFloat(e.target.value);
            document.getElementById('speedValue').textContent = simulationSpeed.toFixed(1) + 'Ã—';
        });
        
        document.querySelectorAll('input[name="inhibitor"]').forEach(radio => {
            radio.addEventListener('change', function(e) {
                inhibitorType = e.target.value;
                
                // Update legend
                const inhibitorLegend = document.getElementById('inhibitorLegend');
                const inhibitorLabel = document.getElementById('inhibitorLabel');
                const inhibitorColour = document.getElementById('inhibitorColour');
                const inactiveLegend = document.getElementById('inactiveLegend');
                const inhibitorInfo = document.getElementById('inhibitorInfo');
                const inhibitorDesc = document.getElementById('inhibitorDesc');
                
                if (inhibitorType !== 'none') {
                    inhibitorLegend.style.display = 'flex';
                    inhibitorInfo.classList.add('active');
                    
                    if (inhibitorType === 'competitive') {
                        inhibitorLabel.textContent = 'Competitive (C)';
                        inhibitorColour.style.background = '#9C27B0';
                        inhibitorDesc.textContent = 'Binds to enzyme active site, preventing substrate binding. Increases apparent Km.';
                        inactiveLegend.style.display = 'none';
                    } else if (inhibitorType === 'noncompetitive') {
                        inhibitorLabel.textContent = 'Non-competitive (N)';
                        inhibitorColour.style.background = '#9C27B0';
                        inhibitorDesc.textContent = 'Binds to allosteric site, reducing enzyme efficiency. Decreases apparent Vmax.';
                        inactiveLegend.style.display = 'none';
                    } else if (inhibitorType === 'covalent') {
                        inhibitorLabel.textContent = 'Covalent (X)';
                        inhibitorColour.style.background = '#D32F2F';
                        inhibitorDesc.textContent = 'Permanently inactivates enzymes through irreversible binding. Progressively reduces active enzyme concentration.';
                        inactiveLegend.style.display = 'flex';
                    }
                } else {
                    inhibitorLegend.style.display = 'none';
                    inactiveLegend.style.display = 'none';
                    inhibitorInfo.classList.remove('active');
                }
                
                // Update kinetics info
                let info = '';
                if (inhibitorType === 'competitive') {
                    info = `Vmax = ${baseVmax} Âµmol/min | Apparent Km = ${(baseKm * 2.5).toFixed(1)} mM (â†‘) | `;
                } else if (inhibitorType === 'noncompetitive') {
                    info = `Apparent Vmax = ${(baseVmax * 0.4).toFixed(1)} Âµmol/min (â†“) | Km = ${baseKm} mM | `;
                } else if (inhibitorType === 'covalent') {
                    info = `Base Vmax = ${baseVmax} Âµmol/min | Km = ${baseKm} mM | Active Enzymes: <span id="activeEnzymes">5/5</span> | `;
                } else {
                    info = `Vmax = ${baseVmax} Âµmol/min | Km = ${baseKm} mM | `;
                }
                
                const currentRate = calculateRate(substrateConcentration);
                info += `Current Rate = <span id="currentRate">${currentRate.toFixed(1)}</span> Âµmol/min`;
                document.getElementById('kineticsInfo').innerHTML = info;
                
                // Reset simulation
                resetSimulation();
            });
        });
        
        // Reset button
        document.getElementById('resetButton').addEventListener('click', function() {
            resetSimulation();
        });
        
        // Initialise
        resizeCanvases();
        initParticles();
        updateMMPlot();
        drawAbsorbanceChart();
        animate();
        
        // Update initial rate display
        const initialRate = calculateRate(substrateConcentration);
        document.getElementById('currentRate').textContent = initialRate.toFixed(1);
        
        // Handle window resize
        window.addEventListener('resize', () => {
            resizeCanvases();
            initParticles();
        });
    </script>
</body>
</html>