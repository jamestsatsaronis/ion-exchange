<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ion Exchange Chromatography Interactive Animation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Trebuchet MS', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 30px;
            max-width: 1400px;
            width: 100%;
        }
        
        h1 {
            color: #5a67d8;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .subtitle {
            text-align: center;
            color: #718096;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        
        .animation-area {
            display: flex;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .column-section {
            flex: 1;
            background: linear-gradient(180deg, #e0e7ff 0%, #c7d2fe 100%);
            border-radius: 15px;
            padding: 20px;
            position: relative;
            min-height: 500px;
        }
        
        .column-wrapper {
            position: relative;
            width: 120px;
            margin: 50px auto 20px;
        }
        
        .column {
            width: 100px;
            height: 380px;
            background: linear-gradient(180deg, #f0f0f0 0%, #e0e0e0 100%);
            border: 3px solid #4a5568;
            border-radius: 10px;
            position: relative;
            overflow: visible;
            margin: 0 auto;
        }
        
        .resin-bead {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            position: absolute;
            background: #f56565;
            border: 2px solid #c53030;
            animation: float 3s ease-in-out infinite;
            z-index: 5;
        }
        
        .resin-bead::after {
            content: '-';
            position: absolute;
            color: white;
            font-weight: bold;
            top: -2px;
            left: 5px;
            font-size: 16px;
        }
        
        .resin-bead.cation {
            background: #4299e1;
            border-color: #2b6cb1;
        }
        
        .resin-bead.cation::after {
            content: '+';
            left: 4px;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-2px) rotate(2deg); }
        }
        
        .protein {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            position: absolute;
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            z-index: 10;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 12px;
        }
        
        .protein.positive {
            background: radial-gradient(circle, #48bb78 0%, #2f855a 100%);
            border: 2px solid #276749;
        }
        
        .protein.positive::after {
            content: '+';
            position: absolute;
            color: white;
            font-weight: bold;
            top: -8px;
            right: -8px;
            font-size: 16px;
            background: #276749;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .protein.negative {
            background: radial-gradient(circle, #ed8936 0%, #c05621 100%);
            border: 2px solid #9c4221;
        }
        
        .protein.negative::after {
            content: '-';
            position: absolute;
            color: white;
            font-weight: bold;
            top: -8px;
            right: -8px;
            font-size: 18px;
            background: #9c4221;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .protein.neutral {
            background: radial-gradient(circle, #9f7aea 0%, #6b46c1 100%);
            border: 2px solid #553c9a;
        }
        
        .protein.neutral::after {
            content: '0';
            position: absolute;
            color: white;
            font-weight: bold;
            top: -8px;
            right: -8px;
            font-size: 14px;
            background: #553c9a;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .protein-label {
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 11px;
            white-space: nowrap;
            color: #2d3748;
            font-weight: bold;
            background: rgba(255,255,255,0.8);
            padding: 2px 4px;
            border-radius: 3px;
        }
        
        .info-panel {
            flex: 1.2;
            background: #f7fafc;
            border-radius: 15px;
            padding: 20px;
        }
        
        .info-panel h2 {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 1.5em;
        }
        
        .ph-control {
            background: #e6fffa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 2px solid #38b2ac;
        }
        
        .ph-slider {
            width: 100%;
            margin: 10px 0;
        }
        
        .ph-display {
            display: flex;
            justify-content: space-between;
            font-weight: bold;
            margin-top: 5px;
        }
        
        .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 10px;
            border-radius: 5px;
            background: linear-gradient(90deg, #fc8181 0%, #ffd700 50%, #4299e1 100%);
            outline: none;
            opacity: 0.9;
        }
        
        .slider:hover {
            opacity: 1;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: white;
            border: 3px solid #5a67d8;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        
        .slider::-moz-range-thumb {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: white;
            border: 3px solid #5a67d8;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        
        .controls {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        button {
            background: white;
            color: #5a67d8;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
            background: #f0f4ff;
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .legend {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-color {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            border: 2px solid #333;
        }
        
        .stage-indicator {
            text-align: center;
            padding: 10px;
            background: #ffd700;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: bold;
            color: #333;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        
        .flow-arrow {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 30px;
            color: #4299e1;
            animation: flowDown 2s ease-in-out infinite;
        }
        
        @keyframes flowDown {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(10px); }
        }
        
        select {
            padding: 10px;
            border-radius: 10px;
            border: 2px solid #5a67d8;
            font-size: 16px;
            background: white;
            cursor: pointer;
        }
        
        .parameter-display {
            background: #fff5f5;
            padding: 10px;
            border-radius: 10px;
            margin-top: 15px;
            border: 2px solid #fc8181;
        }
        
        .protein-info {
            background: #f0fff4;
            padding: 10px;
            border-radius: 10px;
            margin-top: 15px;
            border: 2px solid #48bb78;
            min-height: 100px;
        }
        
        .protein-status {
            margin: 5px 0;
            padding: 5px;
            background: white;
            border-radius: 5px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🧪 Ion Exchange Chromatography</h1>
        <p class="subtitle">Interactive Learning Animation - pH & pI Relationships</p>
        
        <div class="stage-indicator" id="stageIndicator">
            Ready to Start - Adjust pH and Click "Add Proteins" to Begin!
        </div>
        
        <div class="animation-area">
            <div class="column-section">
                <div class="flow-arrow">⬇</div>
                <div class="column-wrapper">
                    <div class="column" id="column"></div>
                </div>
            </div>
            
            <div class="info-panel">
                <h2>Understanding pH & pI</h2>
                
                <div class="ph-control">
                    <strong>Buffer pH Control:</strong>
                    <input type="range" min="3" max="11" value="7" step="0.5" class="slider ph-slider" id="phSlider">
                    <div class="ph-display">
                        <span>pH 3</span>
                        <span style="color: #5a67d8; font-size: 1.2em;">Current pH: <span id="phValue">7.0</span></span>
                        <span>pH 11</span>
                    </div>
                </div>
                
                <div class="parameter-display">
                    <strong>Column Parameters:</strong><br>
                    Column Type: <span id="columnType">Anion Exchange (- beads)</span><br>
                    Buffer pH: <span id="bufferPH" style="font-weight: bold; color: #5a67d8;">7.0</span><br>
                    Salt Concentration: <span id="saltConc">Low</span>
                </div>
                
                <div class="protein-info">
                    <strong>Protein Charge States:</strong>
                    <div id="proteinStates">
                        Adjust pH and add proteins to see their behaviour...
                    </div>
                    <br>
                    <strong style="color: #2b6cb1;">Key Concept:</strong><br>
                    • pH < pI → Protein is positive (+)<br>
                    • pH = pI → Protein is neutral (0)<br>
                    • pH > pI → Protein is negative (-)
                </div>
                
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #48bb78;"></div>
                        <span>Positive (+)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ed8936;"></div>
                        <span>Negative (-)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #9f7aea;"></div>
                        <span>Neutral (0)</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="controls">
            <button onclick="addProteins()">🧬 Add Proteins</button>
            <button onclick="washColumn()">💧 Wash</button>
            <button onclick="eluteColumn()">🧂 Elute (High Salt)</button>
            <button onclick="resetAnimation()">🔄 Reset</button>
            
            <select id="columnTypeSelect" onchange="changeColumnType()">
                <option value="anion">Anion Exchange (- beads)</option>
                <option value="cation">Cation Exchange (+ beads)</option>
            </select>
        </div>
    </div>
    
    <script>
        let proteins = [];
        let columnBeads = [];
        let currentStage = 'ready';
        let columnType = 'anion';
        let currentPH = 7.0;
        
        // Define proteins with different pI values
        const proteinTypes = [
            { name: 'A', pI: 4.5, color: '#e53e3e' },
            { name: 'B', pI: 6.0, color: '#dd6b20' },
            { name: 'C', pI: 7.5, color: '#d69e2e' },
            { name: 'D', pI: 8.5, color: '#38a169' },
            { name: 'E', pI: 9.5, color: '#3182ce' }
        ];
        
        function initColumn() {
            const column = document.getElementById('column');
            column.innerHTML = '';
            columnBeads = [];
            
            // Create resin beads in random positions
            const beadCount = 35; // More beads for better coverage
            const usedPositions = [];
            const beadRadius = 11; // Half of bead total size (18px + 2px border each side)
            
            for (let i = 0; i < beadCount; i++) {
                const bead = document.createElement('div');
                bead.className = `resin-bead ${columnType === 'cation' ? 'cation' : ''}`;
                
                // Find a random position that doesn't overlap too much with existing beads
                let x, y, validPosition;
                let attempts = 0;
                
                do {
                    validPosition = true;
                    // Keep beads away from column boundaries
                    x = beadRadius + Math.random() * (100 - beadRadius * 2); // Stay within column width
                    y = beadRadius + Math.random() * (380 - beadRadius * 2); // Stay within column height
                    
                    // Check minimum distance from other beads
                    for (let pos of usedPositions) {
                        const distance = Math.sqrt(Math.pow(x - pos.x, 2) + Math.pow(y - pos.y, 2));
                        if (distance < 20) { // Minimum 20px apart
                            validPosition = false;
                            break;
                        }
                    }
                    attempts++;
                } while (!validPosition && attempts < 50);
                
                usedPositions.push({x, y});
                
                bead.style.left = `${x - beadRadius}px`; // Adjust for bead size
                bead.style.top = `${y - beadRadius}px`; // Adjust for bead size
                bead.style.animationDelay = `${Math.random() * 3}s`;
                column.appendChild(bead);
                columnBeads.push({
                    element: bead,
                    occupied: false,
                    x: x - beadRadius,
                    y: y - beadRadius
                });
            }
        }
        
        function getProteinCharge(pI, pH) {
            if (pH < pI - 0.5) return 'positive';
            if (pH > pI + 0.5) return 'negative';
            return 'neutral';
        }
        
        function canProteinBind(protein) {
            return (columnType === 'anion' && protein.charge === 'positive') ||
                   (columnType === 'cation' && protein.charge === 'negative');
        }
        
        function updateProteinCharges() {
            proteins.forEach(protein => {
                const oldCharge = protein.charge;
                const newCharge = getProteinCharge(protein.pI, currentPH);
                protein.charge = newCharge;
                protein.element.className = `protein ${newCharge}`;
                protein.element.style.background = `radial-gradient(circle, ${protein.color} 0%, ${protein.darkColor} 100%)`;
                
                // If protein is bound but charge changed so it shouldn't be bound anymore
                if (protein.bound && !canProteinBind(protein)) {
                    // Mark for release but don't release immediately - wait for wash
                    protein.shouldRelease = true;
                } else if (!protein.bound && canProteinBind(protein) && protein.inColumn) {
                    // If protein can now bind and is still in column, try to bind it
                    attemptBinding(protein);
                }
            });
            updateProteinInfo();
        }
        
        function attemptBinding(protein) {
            const availableBeads = columnBeads.filter(b => !b.occupied);
            if (availableBeads.length > 0 && canProteinBind(protein)) {
                const targetBead = availableBeads[Math.floor(Math.random() * availableBeads.length)];
                bindProteinToBead(protein, targetBead);
            }
        }
        
        function bindProteinToBead(protein, bead) {
            const column = document.getElementById('column');
            const columnRect = column.getBoundingClientRect();
            const columnWrapper = column.parentElement;
            const wrapperRect = columnWrapper.getBoundingClientRect();
            
            // Calculate protein position to overlap with bead
            const proteinX = (columnRect.left - wrapperRect.left) + bead.x - 7;
            const proteinY = (columnRect.top - wrapperRect.top) + bead.y - 7;
            
            protein.element.style.left = `${proteinX}px`;
            protein.element.style.top = `${proteinY}px`;
            protein.element.style.zIndex = '20';
            
            bead.occupied = true;
            protein.bound = true;
            protein.boundBead = bead;
            protein.shouldRelease = false;
        }
        
        function addProteins() {
            currentStage = 'loading';
            document.getElementById('stageIndicator').textContent = '⚡ Loading Protein Sample...';
            
            const columnWrapper = document.querySelector('.column-wrapper');
            
            // Remove existing proteins
            proteins.forEach(p => {
                if (p.element && p.element.parentNode) {
                    p.element.remove();
                }
            });
            proteins = [];
            
            // Reset bead occupation
            columnBeads.forEach(bead => bead.occupied = false);
            
            // Create proteins with different pI values
            proteinTypes.forEach((type, index) => {
                const protein = document.createElement('div');
                const charge = getProteinCharge(type.pI, currentPH);
                protein.className = `protein ${charge}`;
                protein.textContent = type.name;
                
                // Create darker colour for gradient
                const darkColor = type.color.replace(/[0-9]/g, (match) => Math.max(0, parseInt(match) - 2));
                protein.style.background = `radial-gradient(circle, ${type.color} 0%, ${darkColor} 100%)`;
                
                // Add label showing pI
                const label = document.createElement('div');
                label.className = 'protein-label';
                label.textContent = `pI ${type.pI}`;
                protein.appendChild(label);
                
                // Starting position above column
                const startX = 35;
                const startY = -50 - (index * 20);
                
                protein.style.left = `${startX}px`;
                protein.style.top = `${startY}px`;
                
                columnWrapper.appendChild(protein);
                
                const proteinData = {
                    element: protein,
                    name: type.name,
                    pI: type.pI,
                    charge: charge,
                    bound: false,
                    inColumn: false,
                    shouldRelease: false,
                    color: type.color,
                    darkColor: darkColor
                };
                proteins.push(proteinData);
                
                // Animate proteins entering column
                setTimeout(() => {
                    enterColumn(proteinData);
                }, index * 300);
            });
            
            updateProteinInfo();
        }
        
        function enterColumn(protein) {
            protein.inColumn = true;
            
            if (canProteinBind(protein)) {
                // Find an unoccupied bead
                const availableBeads = columnBeads.filter(b => !b.occupied);
                if (availableBeads.length > 0) {
                    const targetBead = availableBeads[Math.floor(Math.random() * availableBeads.length)];
                    bindProteinToBead(protein, targetBead);
                    
                    document.getElementById('stageIndicator').textContent = 
                        `🔗 ${protein.charge} proteins binding to ${columnType === 'anion' ? 'negative' : 'positive'} beads!`;
                } else {
                    // All beads occupied, flow through
                    flowThrough(protein);
                }
            } else {
                // Move to middle of column then flow through
                const midY = 150;
                protein.element.style.top = `${midY}px`;
                setTimeout(() => flowThrough(protein), 500);
                document.getElementById('stageIndicator').textContent = 
                    `💧 ${protein.charge} proteins flowing through...`;
            }
        }
        
        function flowThrough(protein) {
            protein.element.style.top = '450px';
            protein.element.style.opacity = '0';
            protein.inColumn = false;
            protein.bound = false;
            
            setTimeout(() => {
                if (protein.element && protein.element.parentNode) {
                    protein.element.remove();
                }
            }, 1000);
        }
        
        function washColumn() {
            currentStage = 'washing';
            document.getElementById('stageIndicator').textContent = '💧 Washing Column...';
            
            proteins.forEach(protein => {
                // Wash away unbound proteins
                if (!protein.bound && protein.element.parentNode) {
                    flowThrough(protein);
                }
                // Also wash away proteins that should be released due to pH change
                else if (protein.bound && protein.shouldRelease) {
                    if (protein.boundBead) {
                        protein.boundBead.occupied = false;
                    }
                    protein.bound = false;
                    protein.shouldRelease = false;
                    flowThrough(protein);
                    document.getElementById('stageIndicator').textContent = 
                        '💧 Washing - pH change released some proteins!';
                }
            });
            
            updateProteinInfo();
        }
        
        function eluteColumn() {
            currentStage = 'eluting';
            document.getElementById('stageIndicator').textContent = '🧂 Eluting with High Salt Buffer!';
            document.getElementById('saltConc').textContent = 'High';
            
            proteins.forEach((protein, index) => {
                if (protein.bound && protein.element.parentNode) {
                    setTimeout(() => {
                        if (protein.boundBead) {
                            protein.boundBead.occupied = false;
                        }
                        protein.element.style.top = '450px';
                        protein.element.style.opacity = '0';
                        protein.bound = false;
                        protein.inColumn = false;
                    }, index * 200);
                }
            });
            
            setTimeout(() => {
                document.getElementById('saltConc').textContent = 'Low';
                updateProteinInfo();
            }, 3000);
        }
        
        function changeColumnType() {
            const select = document.getElementById('columnTypeSelect');
            columnType = select.value;
            document.getElementById('columnType').textContent = 
                columnType === 'anion' ? 'Anion Exchange (- beads)' : 'Cation Exchange (+ beads)';
            resetAnimation();
        }
        
        function updateProteinInfo() {
            const statesDiv = document.getElementById('proteinStates');
            
            if (proteins.length === 0) {
                statesDiv.innerHTML = 'Adjust pH and add proteins to see their behaviour...';
                return;
            }
            
            let html = '';
            proteins.forEach(protein => {
                if (protein.element && protein.element.parentNode) {
                    let status = '';
                    if (protein.bound) {
                        status = protein.shouldRelease ? '⚠️ Will release on wash' : '🔗 Bound';
                    } else if (protein.inColumn) {
                        status = protein.charge === 'neutral' ? '💧 Neutral' : '➡️ Flowing';
                    }
                    
                    const chargeSymbol = protein.charge === 'positive' ? '+' : 
                                        protein.charge === 'negative' ? '-' : '0';
                    html += `<div class="protein-status">
                        Protein ${protein.name} (pI ${protein.pI}): 
                        <strong>${chargeSymbol}</strong> at pH ${currentPH} 
                        ${status}
                    </div>`;
                }
            });
            
            statesDiv.innerHTML = html || 'All proteins eluted or washed away.';
        }
        
        function resetAnimation() {
            currentStage = 'ready';
            document.getElementById('stageIndicator').textContent = 'Ready to Start - Adjust pH and Click "Add Proteins" to Begin!';
            
            // Remove all protein elements
            proteins.forEach(p => {
                if (p.element && p.element.parentNode) {
                    p.element.remove();
                }
            });
            proteins = [];
            
            document.getElementById('saltConc').textContent = 'Low';
            document.getElementById('proteinStates').innerHTML = 'Adjust pH and add proteins to see their behaviour...';
            initColumn();
        }
        
        // pH Slider event
        document.getElementById('phSlider').addEventListener('input', function() {
            currentPH = parseFloat(this.value);
            document.getElementById('phValue').textContent = currentPH.toFixed(1);
            document.getElementById('bufferPH').textContent = currentPH.toFixed(1);
            
            // Update existing protein charges
            if (proteins.length > 0) {
                updateProteinCharges();
            }
        });
        
        // Initialize on load
        initColumn();
    </script>
</body>
</html>